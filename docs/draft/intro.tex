\section{Introduction}
\label{sec:intro}

The relentless march of Moore's law combined with the growing computational demands of contemporary scientific applications are resulting in ever-larger and more powerful supercomputers. Extracting the maximum performance from these leadership-class systems requires tuning not just microprocessor performance, but also achieving optimal networking performance in the supercomputer interconnect. This in turn requires optimizing the communication patterns of the application and the routing algorithms used by the supercomputers. The challenge here is that application communication patterns are time-varying and has widely varying communication characteristics. Furthermore, supercomputer routing algorithms are optimized for typical communication patterns \cite{Chen:BGQ} and this can result in lower throughput for several other communication patterns, resulting in suboptimal performance for certain critical scientific applications. Thus, improving communication performance for generic communication patterns on a leadership-scale system like the IBM Blue Gene/Q is important for improving performance of several applications which are run on such large-scale systems. 

The lower performance in case of several communication patterns is due to the network load imbalance on the physical links, caused by dimension order routing, especially at scale \cite{npc14}. Rebalancing the load can lead to better performance.  
%The low performance in non-favored communication patterns is due to the unbalanced on physically links caused by routing algorithms. Rebalancing loads on the physical links in these communication patterns can lead to better achievable performance. 
In this work, we address the important challenge of optimizing communication between a set of source nodes and another set of destination nodes. In this setting, a set of M source nodes communicates with a set of N destination nodes. These M nodes can be disjoint from the set of N nodes as present in many applications. There can also be overlap between sets of source and destination nodes such as in The Model Coupling Toolkit (MCT) of Community Earth System Model (CESM) application \cite{MCT:Jacob}, or there can be a subset relationship such as in collective I/O aggregation \cite{Vishwanath:GLEAN}. The pairing between nodes in the two sets can be ordered or random depending on the applications' communication patterns.

We propose two approaches that improve networking performance for applications in supercomputers by rebalancing the load on physical links. Our approaches include a heuristic algorithm and a constrained optimization-based formal model with solvers to search for paths to move data from a set of sources to a set of destinations. Our greedy heuristic performs load balancing based on a maximum load threshold, whereas the optimization method selects globally load-aware paths for data transfer. The data is then divided into smaller messages and distributed among these paths. The actual data movement is done by using the available libraries for communication on the supercomputer. 

We implement our algorithms in an extensible framework called OPTIQ. 
We evaluated our approaches for various communication patterns and various number of nodes on the Blue Gene/Q system and compared with MPI\_Alltoallv performance. Overall, our approaches improved performance by 43\% -- 67\% on average on up to 4096 nodes on Blue Gene/Q. The OPTIQ framework is extensible and includes algorithms for recommending multiple paths for data movement, different ways to schedule data transfer and different ways to transfer data. It can also be extended to other systems.

The rest of this paper is organized as follows. 
The next section presents related work. A brief introduction of the OPTIQ framework is presented in \ref{sec:framework}. The details of the OPTIQ formal model and heuristic algorithms are presented in section \ref{sec:approach}. We demonstrate the efficacy of our approach through a detailed evaluation in \ref{sec:benchmark}. Section \ref{sec:conclusion} concludes and also provides some directions for future work.
